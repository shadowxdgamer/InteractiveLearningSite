
const questions = [{"type":"single-choice","text":"Quelle est la principale caractéristique d'une fonction ?","options":[{"id":"8a9c30f9-b97c-4ba7-9629-5b841f0e766e","text":"Elle ne prend pas de paramètres.","code":"","isCorrect":false},{"id":"3606dff6-f005-492e-bb2d-af7dcbf4505c","text":"Elle effectue un calcul et retourne un résultat.","code":"","isCorrect":true},{"id":"32a98413-a14f-4c0b-9eaa-cdf02ad3aaa4","text":"Elle ne retourne pas de résultat.","code":"","isCorrect":false},{"id":"b0bacf73-3dbf-4013-8764-5f5343b1c83c","text":"Elle ne fait pas de calcul.","code":"","isCorrect":false}],"id":"0c9f109f-7783-4033-8915-b8d61f53292b"},{"type":"multiple-choice","text":"Qu'est-ce qu'une procédure ?","options":[{"id":"4ab41d93-daa2-4184-83aa-85d922d2743d","text":"Un sous-programme qui retourne un résultat.","code":"","isCorrect":false},{"id":"bc5af75f-f372-4506-ac34-aeb92f009ef8","text":"Un sous-programme qui effectue un calcul.","code":"","isCorrect":false},{"id":"c472fe6d-4785-45a4-bc05-3b07aeb45a02","text":"Un sous-programme qui ne retourne aucun résultat. ","code":"","isCorrect":true},{"id":"f4896c2e-7d83-4ea1-a3d7-91e3746a76fe","text":"Un sous-programme qui ne prend pas de paramètres.","code":"","isCorrect":false}],"id":"aeb44885-9b3a-4fc9-ba8b-e19a6f69c890"},{"type":"multiple-choice","text":"Quel est le type de la fonction triple dans l'exemple C ?","options":[{"id":"0608b3ac-ab24-4a10-9229-f5ae9a965952","text":"void","code":"","isCorrect":false},{"id":"5332f4f8-9a1c-42d8-991c-43f3a89258ae","text":"int ","code":"","isCorrect":true},{"id":"ff7fb803-53f2-4537-aab1-4c14a9942565","text":"double","code":"","isCorrect":false},{"id":"dca35352-a5ad-4ee1-8857-6930df0a97b6","text":"char","code":"","isCorrect":false}],"id":"1432b7ee-ddc4-4718-9652-d0fc72f79007"},{"type":"single-choice","text":"Dans quel cas une fonction est dite \"paramétrée\" ?","options":[{"id":"4e0a7766-312b-402f-b91d-1f9a6daa96d3","text":"Quand elle ne prend aucun argument.","code":"","isCorrect":false},{"id":"4b469a85-6a1b-41ef-8d33-c01511479e66","text":"Quand elle retourne un résultat.","code":"","isCorrect":false},{"id":"b6dd5b2a-cd44-494f-b1cc-9052d577a46d","text":"Quand elle prend des paramètres d'entrée. ","code":"","isCorrect":true},{"id":"ca4aca3d-4036-41df-bc86-c6ac27842414","text":"Quand elle utilise un pointeur.","code":"","isCorrect":false}],"id":"028de192-f9ea-4e22-93b4-55c79e07aeb4"},{"type":"single-choice","text":"Quel est l'effet du passage de paramètres par valeur ?","options":[{"id":"d8ed81e5-5c63-4ed4-a7d7-0e9e1e2f8d8c","text":" La valeur du paramètre est modifiée dans la fonction.","code":"","isCorrect":false},{"id":"c38d81fe-c8f7-47f3-bba6-95cb0e53f456","text":" La fonction reçoit une copie de la valeur et ne modifie pas l'original. ","code":"","isCorrect":false},{"id":"8686a75b-e979-443d-aa25-3e672d2cc03b","text":"La fonction ne reçoit aucune valeur.","code":"","isCorrect":false},{"id":"835b0337-4f36-453a-be43-3c83405c3b09","text":"Les paramètres sont partagés entre les fonctions.","code":"","isCorrect":false}],"id":"b6777c63-4a15-497a-8b26-0e793c008976"},{"type":"multiple-choice","text":"Quelle est la syntaxe pour déclarer une fonction en C qui ne retourne rien ?","options":[{"id":"0a7b59ad-4270-492a-904a-0a285565d102","text":"int nomFonction()","code":"","isCorrect":false},{"id":"2e9034b6-891a-4734-8843-030d6570e212","text":"void nomFonction()","code":"","isCorrect":true},{"id":"6429caba-95bb-4759-bf90-6da00d1c26bd","text":"char nomFonction()","code":"","isCorrect":false},{"id":"d32dc165-d258-4c00-b39a-e00bb2210961","text":"float nomFonction()","code":"","isCorrect":false}],"id":"84e3871e-032e-414c-8199-4e3493a4ed3b"},{"type":"single-choice","text":"Que fait l'instruction return dans une fonction en C ?","options":[{"id":"9a376677-d486-4dfa-9a51-b5827b08385b","text":"Elle arrête le programme.","code":"","isCorrect":false},{"id":"957308b6-ad6f-4a1d-90fe-fe22dd022c07","text":"Elle renvoie un résultat à la fonction appelante. ","code":"","isCorrect":true},{"id":"76a7b138-c877-437e-9a93-e868b0630242","text":"Elle appelle une autre fonction.","code":"","isCorrect":false},{"id":"58046c3a-7d6f-4ca9-8a8c-403db4b2b49c","text":"Elle affiche un message.","code":"","isCorrect":false}],"id":"e6745b3d-1160-4013-a28a-6f872e0d4e47"},{"type":"single-choice","text":"Qu'est-ce que le passage par référence permet ?","options":[{"id":"59304ecc-fe84-4490-aff8-8cfd7a142e25","text":"Modifier les paramètres passés à la fonction.","code":"","isCorrect":true},{"id":"851a70a5-7c4a-49cc-9d79-8fc82ff67feb","text":"Créer une copie des paramètres.","code":"","isCorrect":false},{"id":"7582cc1e-7f0a-4fdc-8429-a246998dd230","text":"Utiliser uniquement des pointeurs.","code":"","isCorrect":false},{"id":"8aca7867-2519-4abc-bb42-f87fd885fa32","text":"Empêcher toute modification des paramètres.","code":"","isCorrect":false}],"id":"b357ee96-0537-45d4-857b-cab3c1147861"},{"type":"multiple-choice","text":"Dans l'exemple C de la fonction permut, que permet la procédure ?","options":[{"id":"167e5da7-ce1f-4058-b991-f6dcb169de25","text":"Additionner deux entiers.","code":"","isCorrect":false},{"id":"035ee234-468f-4d3d-99a3-0250ec4e4c56","text":"Calculer la somme de deux entiers.","code":"","isCorrect":false},{"id":"6f2ddf87-9c8c-4a28-8ba6-a7695de18a79","text":"Calculer le produit de deux entiers.","code":"","isCorrect":false},{"id":"d1c63aad-a163-4e09-9c8e-c11ed2c3e90a","text":" Permuter les valeurs de deux entiers.","code":"","isCorrect":true}],"id":"5d8ace97-2f37-49f4-a301-cc4bef8525f2"},{"type":"multiple-choice","text":"Comment est passé un paramètre par référence en C ?","options":[{"id":"6d386291-1149-4316-beed-4aa468c0cce1","text":"En utilisant le mot-clé Var","code":"","isCorrect":false},{"id":"ee33ce6c-ef8b-4736-8f51-717c87a382ed","text":"En utilisant l'opérateur &","code":"","isCorrect":true},{"id":"d8703b41-2882-40bb-8ad4-aea50ac60f5b","text":"En utilisant l'opérateur *","code":"","isCorrect":false},{"id":"79c6d95f-4fdc-4479-9051-5d2c56d5c6e1","text":"En déclarant la variable comme static","code":"","isCorrect":false}],"id":"5fd14cc2-888e-4d09-aaf8-022c620df641"}];

// Utility function to escape HTML
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

const t = {
  yourAnswer: "Votre réponse",
  noAnswer: "(Pas de réponse)",
  correctAnswer: "Réponse correcte",
  incorrectAnswer: "Réponse incorrecte",
  placeholders: {
    textAnswer: "Tapez votre réponse ici"
  },
  scoreText: "Vous avez obtenu"
};

let shuffledQuestions = [...questions];

function shuffleQuestions() {
  shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
}

function renderQuiz() {
  shuffleQuestions();
  const quizElement = document.getElementById('quiz');
  if (!quizElement) return;

  quizElement.innerHTML = shuffledQuestions.map((question, index) => {
    const inputName = `question-${index}`;
    const codeHtml = question.code ? `<pre class="code">${escapeHtml(question.code)}</pre>` : '';
    let answersHtml = '';

    if (question.type === 'text') {
      answersHtml = `
        ${codeHtml}
        <input type="text" name="${inputName}" placeholder="${t.placeholders.textAnswer}" />
      `;
    } else if (question.options) {
      answersHtml = question.options.map((option, optIndex) => `
        <div>
          <input type="${question.type === 'multiple-choice' ? 'checkbox' : 'radio'}" 
                 name="${inputName}" 
                 value="${optIndex}" 
                 id="${inputName}-${optIndex}" />
          <label for="${inputName}-${optIndex}">
            ${option.text}
            ${option.code ? `<pre class="code">${escapeHtml(option.code)}</pre>` : ''}
          </label>
        </div>
      `).join('');
      answersHtml = `${codeHtml}${answersHtml}`;
    }

    return `
      <div class="question">
        <span class="question-number">Question ${index + 1}</span>
        <h3>${question.text}</h3>
        ${answersHtml}
        <div id="feedback-${index}" class="answer-feedback" style="display: none;"></div>
      </div>
    `;
  }).join('');
}

function disableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = true);
}

function enableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = false);
}

function checkAnswers() {
  let correctCount = 0;

  shuffledQuestions.forEach((question, index) => {
    const inputName = `question-${index}`;
    const feedbackElement = document.getElementById(`feedback-${index}`);

    if (!feedbackElement) return;

    let isCorrect = false;
    let userAnswer = '';

    if (question.type === 'text') {
      const input = document.querySelector(`input[name="${inputName}"]`);
      userAnswer = input?.value.trim() || '';
      isCorrect = userAnswer.toLowerCase() === (question.correctAnswer?.toLowerCase() || '');
    } else if (question.options) {
      const selectedInputs = document.querySelectorAll(`input[name="${inputName}"]:checked`);
      const selectedIndices = Array.from(selectedInputs).map(input => Number(input.value));

      if (question.type === 'multiple-choice') {
        isCorrect = question.options.every((option, idx) =>
          option.isCorrect === selectedIndices.includes(idx)
        );
        userAnswer = selectedIndices.map(i => question.options[i].text).join(', ');
      } else {
        const selectedInput = selectedInputs[0];
        if (selectedInput) {
          const selectedIndex = Number(selectedInput.value);
          isCorrect = question.options[selectedIndex]?.isCorrect || false;
          userAnswer = question.options[selectedIndex]?.text || '';
        }
      }
    }

    const correctAnswer = question.type === 'text'
      ? question.correctAnswer || t.noAnswer
      : question.options
          .filter(option => option.isCorrect)
          .map(option => option.text)
          .join(', ');

    feedbackElement.style.display = 'block';
    feedbackElement.className = `answer-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    feedbackElement.innerHTML = `
      <p><strong>${isCorrect ? '✓ ' + t.correctAnswer : '✗ ' + t.incorrectAnswer}</strong></p>
      <p>${t.yourAnswer}: ${userAnswer || t.noAnswer}</p>
      ${!isCorrect ? `<p>${t.correctAnswer}: ${correctAnswer}</p>` : ''}
    `;

    if (isCorrect) correctCount++;
  });
  disableInputs();
  showResults(correctCount, shuffledQuestions.length);
}

function showResults(correct, total) {
  const overlay = document.getElementById('modal-overlay');
  const scoreText = document.getElementById('score-text');
  const scoreBarFill = document.getElementById('score-bar-fill');

  if (!overlay || !scoreText || !scoreBarFill) return;

  scoreText.innerText = `${t.scoreText} ${correct} / ${total}`;
  scoreBarFill.style.width = `${(correct / total) * 100}%`;
  overlay.style.display = 'flex';
}

function closeModal() {
  const overlay = document.getElementById('modal-overlay');
  if (overlay) overlay.style.display = 'none';
}

function retestQuiz() {
  enableInputs();
  renderQuiz();
}

// Initialize the quiz
renderQuiz();