
const questions = [{"type":"single-choice","text":"Qu’est-ce qu’un algorithme ?","options":[{"id":"ee065832-d7f4-4d87-8f2a-c09a999bf167","text":"Une langue de programmation","code":"","isCorrect":false},{"id":"d82890b2-cad0-432b-a72f-de04434bd3e1","text":"Une suite finie et non ambiguë d’opérations permettant de résoudre un problème","code":"","isCorrect":true},{"id":"390a98eb-945c-4cb5-ba51-22d682255e1f","text":"Un type de logiciel","code":"","isCorrect":false},{"id":"565c92b4-1e8b-4467-8680-0b0549f2ff02","text":"Un composant matériel informatique","code":"","isCorrect":false}],"id":"2971ca02-b904-42f2-b1c1-b6cd1fc04773"},{"type":"single-choice","text":"Pourquoi faut-il traduire un algorithme dans un langage de programmation ?","options":[{"id":"93c1269e-4a3e-4b82-a49c-ce5c72a14c9b","text":"Pour le rendre plus rapide","code":"","isCorrect":false},{"id":"95cdf104-cd5e-4fa4-9478-5968bb333b4f","text":"Pour le rendre compréhensible par un ordinateur","code":"","isCorrect":true},{"id":"458f7577-7351-4e22-8fe5-bc43adb52a8e","text":"Pour simplifier le problème","code":"","isCorrect":false},{"id":"b2b928f3-57a0-4bac-a1de-b1a928f5dda6","text":"Pour remplacer les données","code":"","isCorrect":false}],"id":"6ec79956-2e42-40b9-87f0-253dd6e6e294"},{"type":"text","text":"Comment appelle-t-on un algorithme traduit dans un langage de programmation ?","correctAnswer":"Un programme","id":"a802536c-f451-4aa5-8885-fccb1522ad55"},{"type":"single-choice","text":"Quel est le rôle principal d’un programmeur ?","options":[{"id":"a7e3d834-3c82-4b64-bf3e-2296284b6621","text":"Utiliser des logiciels","code":"","isCorrect":false},{"id":"38467f69-94a8-4eee-b422-b91851849d2f","text":"Réparer des composants matériels","code":"","isCorrect":false},{"id":"7cb1c67f-dbad-4cec-9a2f-cfd34f9e8da2","text":"Créer et mettre en œuvre des programmes informatiques à l'aide de langages de programmation","code":"","isCorrect":true},{"id":"5d6a76d0-0850-417f-812e-a8da97cd76d1","text":"Tester les programmes en tant qu’utilisateur","code":"","isCorrect":false}],"id":"ae421f8f-dfa7-428d-a5f0-e7d41767ad98"},{"type":"multiple-choice","text":"Quelles sont les étapes pour résoudre un problème de manière algorithmique ?","options":[{"id":"bfb41792-266d-4c25-a2a2-2fe3ffd58f2a","text":"Comprendre l’énoncé du problème","code":"","isCorrect":true},{"id":"2632c79d-d373-452a-b29e-6e4aea0000e0","text":"Décomposer le problème en sous-problèmes simples","code":"","isCorrect":true},{"id":"d39077f3-b131-4f31-8735-e639fa7f053b","text":"Élaborer un algorithme pour chaque sous-problème","code":"","isCorrect":true},{"id":"a90d3ca2-2682-4402-8de1-eff68f883805","text":"Sauter directement à l’exécution du programme","code":"","isCorrect":false}],"id":"e7525230-3891-4c84-a902-9bfb8fb300ac"},{"type":"single-choice","text":"Dans le programme C, quelle fonction est utilisée pour demander une saisie utilisateur ?","options":[{"id":"ca419008-5834-4566-87e5-6164e422263b","text":"printf()","code":"","isCorrect":false},{"id":"2a60d65a-79be-4afc-b473-855d2cbbcf0a","text":"scanf()","code":"","isCorrect":true},{"id":"1d9cc49d-095b-48a2-b6ba-116ce84e2bf5","text":"return()","code":"","isCorrect":false},{"id":"75d87336-a532-4847-9f2c-9d95b6399c54","text":"main()","code":"","isCorrect":false}],"id":"ad60550a-8676-443d-aa5c-b86a8b90fd26"},{"type":"single-choice","text":"Quel est l'objectif principal d’un utilisateur dans le contexte des programmes informatiques ?","options":[{"id":"0acf4c98-5cec-44a5-a65e-f7fdbe7ad3c0","text":"Créer de nouveaux logiciels","code":"","isCorrect":false},{"id":"965fb620-dbe6-4134-8c47-75251b972050","text":"Traduire des algorithmes en langage machine","code":"","isCorrect":false},{"id":"da902606-dcd0-4410-9ae7-d08123db4163","text":"Débugger les logiciels","code":"","isCorrect":false},{"id":"a51f4164-ab7b-48ea-8b05-dbeab85f2e30","text":"Utiliser les programmes pour accomplir des tâches spécifiques","code":"","isCorrect":true}],"id":"00c3bca1-5edd-4f5d-a277-2f2567ea572f"},{"type":"multiple-choice","text":"Quelles qualités doit avoir un algorithme ?","options":[{"id":"83c38022-29be-45ba-8667-7ea2c9175b08","text":"Finitude","code":"","isCorrect":true},{"id":"6e7b88f4-a30e-4596-b08a-3be4142ea88c","text":"Non ambiguïté","code":"","isCorrect":true},{"id":"7ed8c689-a7cc-4a87-a6a0-928a1dd330b9","text":"Flexibilité infinie","code":"","isCorrect":false},{"id":"e72aa07b-981f-4cec-b2d2-749e413d08de","text":"Simplicité logique","code":"","isCorrect":true}],"id":"e2ea15e7-ed17-4b32-ba9a-c9e64cab6644"},{"type":"single-choice","text":"Quel est le premier pas dans la résolution algorithmique d’un problème ?","options":[{"id":"655a841f-dd81-4a4e-ae56-cae0cb32d39d","text":"Comprendre et analyser le problème","code":"","isCorrect":true},{"id":"b79be979-6323-45a3-8b9d-1c503bb24921","text":"Élaborer un programme directement","code":"","isCorrect":false},{"id":"27ef2109-3522-4f3d-b99d-fca46625ed8d","text":"Tester toutes les solutions possibles","code":"","isCorrect":false},{"id":"f265a6b5-4689-459d-8628-d50cea3a7023","text":"Définir les résultats attendus","code":"","isCorrect":false}],"id":"d59cf267-ccc9-4e90-8e33-282ac35cf618"}];

// Utility function to escape HTML
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

const t = {
  yourAnswer: "Votre réponse",
  noAnswer: "(Pas de réponse)",
  correctAnswer: "Réponse correcte",
  incorrectAnswer: "Réponse incorrecte",
  placeholders: {
    textAnswer: "Tapez votre réponse ici"
  },
  scoreText: "Vous avez obtenu"
};

let shuffledQuestions = [...questions];

function shuffleQuestions() {
  shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
}

function renderQuiz() {
  shuffleQuestions();
  const quizElement = document.getElementById('quiz');
  if (!quizElement) return;

  quizElement.innerHTML = shuffledQuestions.map((question, index) => {
    const inputName = `question-${index}`;
    const codeHtml = question.code ? `<pre class="code">${escapeHtml(question.code)}</pre>` : '';
    let answersHtml = '';

    if (question.type === 'text') {
      answersHtml = `
        ${codeHtml}
        <input type="text" name="${inputName}" placeholder="${t.placeholders.textAnswer}" />
      `;
    } else if (question.options) {
      answersHtml = question.options.map((option, optIndex) => `
        <div>
          <input type="${question.type === 'multiple-choice' ? 'checkbox' : 'radio'}" 
                 name="${inputName}" 
                 value="${optIndex}" 
                 id="${inputName}-${optIndex}" />
          <label for="${inputName}-${optIndex}">
            ${option.text}
            ${option.code ? `<pre class="code">${escapeHtml(option.code)}</pre>` : ''}
          </label>
        </div>
      `).join('');
      answersHtml = `${codeHtml}${answersHtml}`;
    }

    return `
      <div class="question">
        <span class="question-number">Question ${index + 1}</span>
        <h3>${question.text}</h3>
        ${answersHtml}
        <div id="feedback-${index}" class="answer-feedback" style="display: none;"></div>
      </div>
    `;
  }).join('');
}

function disableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = true);
}

function enableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = false);
}

function checkAnswers() {
  let correctCount = 0;

  shuffledQuestions.forEach((question, index) => {
    const inputName = `question-${index}`;
    const feedbackElement = document.getElementById(`feedback-${index}`);

    if (!feedbackElement) return;

    let isCorrect = false;
    let userAnswer = '';

    if (question.type === 'text') {
      const input = document.querySelector(`input[name="${inputName}"]`);
      userAnswer = input?.value.trim() || '';
      isCorrect = userAnswer.toLowerCase() === (question.correctAnswer?.toLowerCase() || '');
    } else if (question.options) {
      const selectedInputs = document.querySelectorAll(`input[name="${inputName}"]:checked`);
      const selectedIndices = Array.from(selectedInputs).map(input => Number(input.value));

      if (question.type === 'multiple-choice') {
        isCorrect = question.options.every((option, idx) =>
          option.isCorrect === selectedIndices.includes(idx)
        );
        userAnswer = selectedIndices.map(i => question.options[i].text).join(', ');
      } else {
        const selectedInput = selectedInputs[0];
        if (selectedInput) {
          const selectedIndex = Number(selectedInput.value);
          isCorrect = question.options[selectedIndex]?.isCorrect || false;
          userAnswer = question.options[selectedIndex]?.text || '';
        }
      }
    }

    const correctAnswer = question.type === 'text'
      ? question.correctAnswer || t.noAnswer
      : question.options
          .filter(option => option.isCorrect)
          .map(option => option.text)
          .join(', ');

    feedbackElement.style.display = 'block';
    feedbackElement.className = `answer-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    feedbackElement.innerHTML = `
      <p><strong>${isCorrect ? '✓ ' + t.correctAnswer : '✗ ' + t.incorrectAnswer}</strong></p>
      <p>${t.yourAnswer}: ${userAnswer || t.noAnswer}</p>
      ${!isCorrect ? `<p>${t.correctAnswer}: ${correctAnswer}</p>` : ''}
    `;

    if (isCorrect) correctCount++;
  });
  disableInputs();
  showResults(correctCount, shuffledQuestions.length);
}

function showResults(correct, total) {
  const overlay = document.getElementById('modal-overlay');
  const scoreText = document.getElementById('score-text');
  const scoreBarFill = document.getElementById('score-bar-fill');

  if (!overlay || !scoreText || !scoreBarFill) return;

  scoreText.innerText = `${t.scoreText} ${correct} / ${total}`;
  scoreBarFill.style.width = `${(correct / total) * 100}%`;
  overlay.style.display = 'flex';
}

function closeModal() {
  const overlay = document.getElementById('modal-overlay');
  if (overlay) overlay.style.display = 'none';
}

function retestQuiz() {
  enableInputs();
  renderQuiz();
}

// Initialize the quiz
renderQuiz();