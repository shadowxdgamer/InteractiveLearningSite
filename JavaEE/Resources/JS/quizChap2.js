
const questions = [{"type":"single-choice","text":"À quoi sert Jakarta EE ?","options":[{"id":"11c8c5db-edaf-4f1c-9f28-7899d9079585","text":"Développer des jeux vidéo.","code":"","isCorrect":false},{"id":"37cfa972-6d4c-4b8c-aa55-44c6701f561b","text":"Faciliter le développement d’applications professionnelles distribuées.","code":"","isCorrect":true},{"id":"4f54c40f-2a3f-4117-bc37-c57070d4db10","text":"Optimiser les systèmes d’exploitation.","code":"","isCorrect":false},{"id":"cdd482c2-4700-466e-8c76-a5238d255760","text":"Gérer les bases de données uniquement.","code":"","isCorrect":false}],"id":"f5229556-605a-4cbd-92c5-71e4862e4dde"},{"type":"single-choice","text":"Quelle est la principale différence entre Java SE et Jakarta EE ?","options":[{"id":"753aad87-df90-431e-a5b8-bd7678e9865b","text":"Jakarta EE propose des bibliothèques pour les applications professionnelles.","code":"","isCorrect":true},{"id":"83a61cbe-4348-4c0d-80cc-fbb853a3bf19","text":"Java SE est utilisé uniquement pour les bases de données.","code":"","isCorrect":false},{"id":"ba0ab5fe-d5b0-457c-aa02-f5d1f7d6702e","text":"Java SE nécessite un serveur d’applications.","code":"","isCorrect":false},{"id":"d4fd73ba-f238-4c91-b376-9b6fae353278","text":"Jakarta EE ne permet pas d’exécuter des applications distribuées.","code":"","isCorrect":false}],"id":"aa9b82aa-a489-4ca4-a3ff-d8274497a8a7"},{"type":"multiple-choice","text":"Quels sont les quatre niveaux principaux d’une application Java EE multi-tiers ?","options":[{"id":"d8b8b468-0904-4a48-8402-83ad1c2ac142","text":"Les clients.","code":"","isCorrect":true},{"id":"9ea61bca-7070-441f-bae7-76e7c021a9b3","text":"La couche Web.","code":"","isCorrect":true},{"id":"b98382ea-d7af-4e43-95c4-d2dfadcf9a6a","text":"Les composants EJB.","code":"","isCorrect":false},{"id":"802615bc-c65c-4ad9-880c-fc62ef9b2279","text":"La base de données (tiers EIS).","code":"","isCorrect":true}],"id":"c8ed5191-7b08-4b6d-8aeb-b216935fffc2"},{"type":"single-choice","text":"Quels services le conteneur Web de Jakarta EE offre-t-il ?","options":[{"id":"f377da3d-8f82-49d8-b99b-98347745b081","text":"Gestion des EJB uniquement.","code":"","isCorrect":false},{"id":"62d07c90-d3e8-44a4-bb81-2bfcdcbfe5e5","text":"Exécution des pages JSP, Servlets et JSF.","code":"","isCorrect":true},{"id":"89d4bd06-54f0-49df-8262-00285d9c795a","text":"Interaction directe avec les bases de données.","code":"","isCorrect":false},{"id":"0b1a051a-bf58-4d18-bfe0-ac7737400233","text":"Compression des fichiers pour le stockage.","code":"","isCorrect":false}],"id":"71c1d35b-25fb-464a-86a1-5fdb1442c81e"},{"type":"multiple-choice","text":"Quels fichiers sont nécessaires pour déployer une application dans un conteneur ?","options":[{"id":"c8ec23ce-1191-4b55-a960-fa2820cd89ed","text":"Une clé d'authentification.","code":"","isCorrect":false},{"id":"6cdc163e-1cec-4780-a4d6-6daca4db03cb","text":"Un fichier RAR pour chaque classe.","code":"","isCorrect":false},{"id":"9146e169-0646-467d-b987-61b4d2df029e","text":"Les classes compilées et ressources de l'application.","code":"","isCorrect":true},{"id":"75e7cb35-c46b-443b-a136-7c089cb3869b","text":"Un fichier descripteur de déploiement.","code":"","isCorrect":true}],"id":"7dcc9b51-0e06-40a6-94db-e433e0f0cd09"},{"type":"multiple-choice","text":"Quel format d'archive est utilisé pour regrouper plusieurs modules dans une seule application ?","options":[{"id":"c3cc1b5f-ddc2-4f98-adc9-8d7bd9eeca77","text":"JAR","code":"","isCorrect":false},{"id":"8ef0b6a0-1cdb-4a58-8060-2afc1da2e839","text":"WAR","code":"","isCorrect":false},{"id":"f5844eac-dceb-4a87-86b1-849b2a0d69cf","text":"EAR","code":"","isCorrect":true},{"id":"7cf923ff-faf6-432d-a79a-40e6bf2b28d2","text":"RAR","code":"","isCorrect":false}],"id":"9696bc79-0048-44cf-afff-93a74f2e0976"},{"type":"single-choice","text":"En quoi consiste un conteneur EJB ?","options":[{"id":"8cebb388-a769-424b-b53f-09226ab3709b","text":"Héberger les fichiers XML uniquement.","code":"","isCorrect":false},{"id":"22ca8668-0c33-4276-80d3-70faf3e24105","text":"Gérer la connexion avec des serveurs tiers.","code":"","isCorrect":false},{"id":"aa18f90d-14de-47fe-850e-c610141b3cae","text":"Fournir des services HTTP pour les navigateurs.","code":"","isCorrect":false},{"id":"29c9dadd-3c82-4631-915b-72f38021c111","text":"Gérer le cycle de vie et l’exécution des EJB.","code":"","isCorrect":true}],"id":"5f32934e-6966-4ce1-bba8-8fb014b2452e"},{"type":"multiple-choice","text":"Pourquoi utiliser Jakarta EE pour une application ?","options":[{"id":"987388cf-89e8-499b-b2b9-cc69c06cff6a","text":"Flexibilité dans le choix de l'architecture.","code":"","isCorrect":true},{"id":"fb8628a3-cf83-4a1b-b745-1c049630e2c5","text":"Compatibilité avec des systèmes non Java.","code":"","isCorrect":false},{"id":"48448f46-1acc-4fa6-b942-800d38d680a6","text":"Interaction facile avec le système d’information existant via des API.","code":"","isCorrect":true},{"id":"33fd71e6-4fb5-44a3-8b81-0d83bd659648","text":"Disponibilité uniquement en local.","code":"","isCorrect":false}],"id":"206c78d7-f5bf-4a85-9d08-82f2a6e5f720"},{"type":"single-choice","text":"Quelle API Jakarta EE est utilisée pour se connecter aux bases de données ?","options":[{"id":"9cf1a6e8-e280-437e-a521-b5485b4691b7","text":"JMS","code":"","isCorrect":false},{"id":"953626a8-87b5-485f-bedf-d68ce9a7957f","text":"JNDI","code":"","isCorrect":false},{"id":"76d4ca3b-2cf3-4a8f-a9cc-864a5a72b9b9","text":"JDBC","code":"","isCorrect":true},{"id":"5ab297ea-b121-4b70-ab8d-b84716df3f0d","text":"JSF","code":"","isCorrect":false}],"id":"502ad3f9-8b8b-4896-a89b-2da4b63fbb03"},{"type":"multiple-choice","text":"Quels conteneurs peuvent être fournis par un serveur d'applications Jakarta EE ?","options":[{"id":"682def2f-4d9e-4f48-920e-129f9d5b38e0","text":"Conteneur Web","code":"","isCorrect":true},{"id":"53518642-32df-4adb-8d8f-b04be4a8d073","text":"Conteneur EJB","code":"","isCorrect":true},{"id":"cc484161-a22b-4d80-98d8-5dcac1254ab3","text":"Conteneur JSP uniquement.","code":"","isCorrect":false},{"id":"c71760ce-4913-43dd-baee-244ce762a106","text":"Conteneur HTTP uniquement","code":"","isCorrect":false}],"id":"fef23829-f229-488a-8435-699bffba2c2b"}];

// Utility function to escape HTML
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

const t = {
  yourAnswer: "Votre réponse",
  noAnswer: "(Pas de réponse)",
  correctAnswer: "Réponse correcte",
  incorrectAnswer: "Réponse incorrecte",
  placeholders: {
    textAnswer: "Tapez votre réponse ici"
  },
  scoreText: "Vous avez obtenu"
};

let shuffledQuestions = [...questions];

function shuffleQuestions() {
  shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
}

function renderQuiz() {
  shuffleQuestions();
  const quizElement = document.getElementById('quiz');
  if (!quizElement) return;

  quizElement.innerHTML = shuffledQuestions.map((question, index) => {
    const inputName = `question-${index}`;
    const codeHtml = question.code ? `<pre class="code">${escapeHtml(question.code)}</pre>` : '';
    let answersHtml = '';

    if (question.type === 'text') {
      answersHtml = `
        ${codeHtml}
        <input type="text" name="${inputName}" placeholder="${t.placeholders.textAnswer}" />
      `;
    } else if (question.options) {
      answersHtml = question.options.map((option, optIndex) => `
        <div>
          <input type="${question.type === 'multiple-choice' ? 'checkbox' : 'radio'}" 
                 name="${inputName}" 
                 value="${optIndex}" 
                 id="${inputName}-${optIndex}" />
          <label for="${inputName}-${optIndex}">
            ${option.text}
            ${option.code ? `<pre class="code">${escapeHtml(option.code)}</pre>` : ''}
          </label>
        </div>
      `).join('');
      answersHtml = `${codeHtml}${answersHtml}`;
    }

    return `
      <div class="question">
        <span class="question-number">Question ${index + 1}</span>
        <h3>${question.text}</h3>
        ${answersHtml}
        <div id="feedback-${index}" class="answer-feedback" style="display: none;"></div>
      </div>
    `;
  }).join('');
}

function disableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = true);
}

function enableInputs() {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => input.disabled = false);
}

function checkAnswers() {
  let correctCount = 0;

  shuffledQuestions.forEach((question, index) => {
    const inputName = `question-${index}`;
    const feedbackElement = document.getElementById(`feedback-${index}`);

    if (!feedbackElement) return;

    let isCorrect = false;
    let userAnswer = '';

    if (question.type === 'text') {
      const input = document.querySelector(`input[name="${inputName}"]`);
      userAnswer = input?.value.trim() || '';
      isCorrect = userAnswer.toLowerCase() === (question.correctAnswer?.toLowerCase() || '');
    } else if (question.options) {
      const selectedInputs = document.querySelectorAll(`input[name="${inputName}"]:checked`);
      const selectedIndices = Array.from(selectedInputs).map(input => Number(input.value));

      if (question.type === 'multiple-choice') {
        isCorrect = question.options.every((option, idx) =>
          option.isCorrect === selectedIndices.includes(idx)
        );
        userAnswer = selectedIndices.map(i => question.options[i].text).join(', ');
      } else {
        const selectedInput = selectedInputs[0];
        if (selectedInput) {
          const selectedIndex = Number(selectedInput.value);
          isCorrect = question.options[selectedIndex]?.isCorrect || false;
          userAnswer = question.options[selectedIndex]?.text || '';
        }
      }
    }

    const correctAnswer = question.type === 'text'
      ? question.correctAnswer || t.noAnswer
      : question.options
          .filter(option => option.isCorrect)
          .map(option => option.text)
          .join(', ');

    feedbackElement.style.display = 'block';
    feedbackElement.className = `answer-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    feedbackElement.innerHTML = `
      <p><strong>${isCorrect ? '✓ ' + t.correctAnswer : '✗ ' + t.incorrectAnswer}</strong></p>
      <p>${t.yourAnswer}: ${userAnswer || t.noAnswer}</p>
      ${!isCorrect ? `<p>${t.correctAnswer}: ${correctAnswer}</p>` : ''}
    `;

    if (isCorrect) correctCount++;
  });
  disableInputs();
  showResults(correctCount, shuffledQuestions.length);
}

function showResults(correct, total) {
  const overlay = document.getElementById('modal-overlay');
  const scoreText = document.getElementById('score-text');
  const scoreBarFill = document.getElementById('score-bar-fill');

  if (!overlay || !scoreText || !scoreBarFill) return;

  scoreText.innerText = `${t.scoreText} ${correct} / ${total}`;
  scoreBarFill.style.width = `${(correct / total) * 100}%`;
  overlay.style.display = 'flex';
}

function closeModal() {
  const overlay = document.getElementById('modal-overlay');
  if (overlay) overlay.style.display = 'none';
}

function retestQuiz() {
  enableInputs();
  renderQuiz();
}

// Initialize the quiz
renderQuiz();